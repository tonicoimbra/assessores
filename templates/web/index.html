<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Assessor.AI | TJPR</title>
  <meta name="description"
    content="Sistema de análise de admissibilidade de recursos especiais e extraordinários do TJPR">
  <link rel="stylesheet" href="/static/css/styles.css">
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚖️</text></svg>">
</head>

<body>
  <div class="page-wrapper">

    <!-- Header -->
    <header class="header">
      <div class="header-inner">
        <div class="header-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
            stroke-linejoin="round">
            <path d="M12 3v2M6.5 8h11M4 8l2.1 9.4a2 2 0 0 0 2 1.6h7.8a2 2 0 0 0 2-1.6L20 8" />
            <circle cx="12" cy="5" r="1" fill="currentColor" />
            <path d="M5 21h14" />
          </svg>
        </div>
        <div class="header-text">
          <h1>Assessor.AI</h1>
          <p>TJPR — Análise de Admissibilidade</p>
        </div>
        <span class="header-badge">v2.0</span>
      </div>
    </header>

    <!-- Main -->
    <main class="main-content">

      {% if error %}
      <div class="alert alert-error" role="alert">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <circle cx="12" cy="12" r="10" />
          <line x1="15" y1="9" x2="9" y2="15" />
          <line x1="9" y1="9" x2="15" y2="15" />
        </svg>
        <span>{{ error }}</span>
      </div>
      {% endif %}

      <!-- Upload Card -->
      <section class="card" style="margin-bottom: var(--spacing-xl);">
        <div class="card-header">
          <h2 class="card-title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="17 8 12 3 7 8" />
              <line x1="12" y1="3" x2="12" y2="15" />
            </svg>
            Enviar Documentos
          </h2>
          <p class="card-description">Faça upload do recurso e acórdão em PDF para gerar a minuta de admissibilidade.
          </p>
        </div>

        <form id="uploadForm" method="post" action="/processar" enctype="multipart/form-data">

          <!-- Upload Zones -->
          <div class="upload-grid">

            <!-- Recurso -->
            <div class="upload-zone" id="zoneRecurso">
              <input type="file" name="recurso_pdf" id="recurso_pdf" accept="application/pdf" required>
              <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                <polyline points="14 2 14 8 20 8" />
                <line x1="12" y1="18" x2="12" y2="12" />
                <polyline points="9 15 12 12 15 15" />
              </svg>
              <div class="upload-label">PDF do Recurso</div>
              <div class="upload-hint">Clique ou arraste o arquivo</div>
              <div class="upload-filename" id="filenameRecurso"></div>
            </div>

            <!-- Acórdão -->
            <div class="upload-zone" id="zoneAcordao">
              <input type="file" name="acordao_pdf" id="acordao_pdf" accept="application/pdf" required>
              <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                <polyline points="14 2 14 8 20 8" />
                <line x1="12" y1="18" x2="12" y2="12" />
                <polyline points="9 15 12 12 15 15" />
              </svg>
              <div class="upload-label">PDF do Acórdão</div>
              <div class="upload-hint">Clique ou arraste o arquivo</div>
              <div class="upload-filename" id="filenameAcordao"></div>
            </div>

          </div>

          <!-- Options -->
          <div class="options-grid">
            <div class="form-group">
              <label class="form-label" for="modelo">Modelo IA</label>
              <select class="form-select" name="modelo" id="modelo">
                <option value="gpt-4o" {% if default_model=="gpt-4o" %}selected{% endif %}>GPT-4o (Recomendado - Melhor
                  Qualidade)</option>
                <option value="deepseek/deepseek-r1" {% if default_model=="deepseek/deepseek-r1" %}selected{% endif %}>
                  DeepSeek R1 (Raciocínio Avançado)</option>
                <option value="google/gemini-2.0-flash-001" {% if default_model=="google/gemini-2.0-flash-001"
                  %}selected{% endif %}>Gemini 2.0 Flash (Mais Rápido)</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label" for="formato">Formato da Minuta</label>
              <select class="form-select" name="formato" id="formato">
                <option value="md">Markdown (.md)</option>
                <option value="docx">Word (.docx)</option>
              </select>
            </div>
          </div>

          <!-- Submit -->
          <button type="submit" class="btn btn-primary" id="submitBtn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
            </svg>
            Processar Documentos
          </button>

        </form>
      </section>

      {% if result %}
      <!-- Result Card -->
      <section class="card result-section">
        <div class="card-header">
          <h2 class="card-title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
              <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
            Resultado da Análise
          </h2>
        </div>

        <!-- Metrics -->
        <div class="metrics-grid">
          <div
            class="metric-card decision {% if result.decisao and 'INADMISS' in result.decisao|upper %}negative{% endif %}">
            <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10" />
              <path d="M9 12l2 2 4-4" />
            </svg>
            <div class="metric-label">Decisão</div>
            <div class="metric-value">{{ result.decisao }}</div>
          </div>

          <div class="metric-card">
            <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
            </svg>
            <div class="metric-label">Tokens</div>
            <div class="metric-value">{{ "{:,}".format(result.tokens) }}</div>
          </div>

          <div class="metric-card">
            <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="1" x2="12" y2="23" />
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
            </svg>
            <div class="metric-label">Custo (USD)</div>
            <div class="metric-value">${{ '%.4f'|format(result.custo) }}</div>
          </div>

          <div class="metric-card">
            <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10" />
              <polyline points="12 6 12 12 16 14" />
            </svg>
            <div class="metric-label">Tempo</div>
            <div class="metric-value">{{ '%.1f'|format(result.tempo) }}s</div>
          </div>
        </div>

        <!-- Downloads -->
        <div class="downloads-row">
          <a href="/download?path={{ result.arquivo_minuta|urlencode }}" class="btn btn-outline">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="7 10 12 15 17 10" />
              <line x1="12" y1="15" x2="12" y2="3" />
            </svg>
            Baixar Minuta
          </a>
          <a href="/download?path={{ result.arquivo_auditoria|urlencode }}" class="btn btn-outline">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
              <polyline points="14 2 14 8 20 8" />
              <line x1="16" y1="13" x2="8" y2="13" />
              <line x1="16" y1="17" x2="8" y2="17" />
              <polyline points="10 9 9 9 8 9" />
            </svg>
            Baixar Auditoria
          </a>
        </div>

        <!-- Preview -->
        <div class="preview-container">
          <div class="preview-header">
            <span class="preview-label">Preview da Minuta</span>
          </div>
          <pre class="preview-content">{{ result.preview }}</pre>
        </div>
      </section>
      {% endif %}

    </main>

    <!-- Footer -->
    <footer class="footer">
      Assessor.AI &copy; TJPR — Sistema de apoio à decisão
    </footer>

  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-card">
      <div class="spinner"></div>
      <div class="loading-title">Processando documentos…</div>
      <div class="loading-subtitle">Isso pode levar alguns minutos</div>
    </div>
  </div>

  <script>
    // Upload zone interactivity
    document.querySelectorAll('.upload-zone').forEach(zone => {
      const input = zone.querySelector('input[type="file"]');
      const filenameEl = zone.querySelector('.upload-filename');

      input.addEventListener('change', () => {
        if (input.files.length > 0) {
          zone.classList.add('has-file');
          filenameEl.textContent = '✓ ' + input.files[0].name;
        } else {
          zone.classList.remove('has-file');
          filenameEl.textContent = '';
        }
      });

      zone.addEventListener('dragover', e => {
        e.preventDefault();
        zone.classList.add('dragover');
      });

      zone.addEventListener('dragleave', () => {
        zone.classList.remove('dragover');
      });

      zone.addEventListener('drop', e => {
        e.preventDefault();
        zone.classList.remove('dragover');
        if (e.dataTransfer.files.length > 0) {
          input.files = e.dataTransfer.files;
          input.dispatchEvent(new Event('change'));
        }
      });
    });

    // Loading overlay on submit
    document.getElementById('uploadForm').addEventListener('submit', function () {
      const recurso = document.getElementById('recurso_pdf');
      const acordao = document.getElementById('acordao_pdf');

      if (recurso.files.length > 0 && acordao.files.length > 0) {
        document.getElementById('loadingOverlay').classList.add('active');
        document.getElementById('submitBtn').disabled = true;
      }
    });
  </script>
</body>

</html>