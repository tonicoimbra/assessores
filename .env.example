# ==========================================
# ASSESSOR.AI - CONFIGURAÇÃO
# ==========================================

# OpenAI API (Obrigatória)
OPENAI_API_KEY=sk-proj-...

# LLM Provider (openai | openrouter | google)
# Default: openai
LLM_PROVIDER=openai

# ==========================================
# MODELOS DE IA
# ==========================================

# Modelo principal para análise jurídica
# GPT-4.1: Contexto 1M tokens | $2.00/M input, $8.00/M output
OPENAI_MODEL=gpt-4.1

# Temperatura (0.0 = determinístico, 1.0 = criativo)
TEMPERATURE=0.0

# Tokens máximos por resposta
MAX_TOKENS=2048

# Limites por etapa (ajuste fino de custo/latência)
MAX_TOKENS_INTERMEDIATE=700
MAX_TOKENS_ETAPA1=1400
MAX_TOKENS_ETAPA2=2200
MAX_TOKENS_ETAPA3=3200

# ==========================================
# CONFIGURAÇÃO DE CHAMADAS LLM
# ==========================================

# Timeout de requisição (segundos)
LLM_TIMEOUT=120

# Máximo de tentativas em caso de erro
LLM_MAX_RETRIES=3

# Perfil de prompt:
# lean = sem referências longas (mais rápido e econômico)
# full = injeta referencias_longas nas etapas 2 e 3
PROMPT_PROFILE=lean
# Estratégia de prompt: modular (padrão) ou legacy (rollback rápido para SYSTEM_PROMPT.md).
PROMPT_STRATEGY=modular
# Segurança de prompt: em produção mantenha false para evitar fallback minimalista silencioso.
ALLOW_MINIMAL_PROMPT_FALLBACK=false

# ==========================================
# MODELOS HÍBRIDOS (ECONOMIA DE CUSTOS)
# ==========================================

# Modelo para classificação de documentos
# GPT-4.1-mini: 93% mais econômico | $0.15/M input, $0.60/M output
MODEL_CLASSIFICATION=gpt-4.1-mini

# Modelo para análise jurídica (Etapas 1-2)
MODEL_LEGAL_ANALYSIS=gpt-4.1

# Modelo para geração de minuta (Etapa 3)
MODEL_DRAFT_GENERATION=gpt-4.1

# ==========================================
# FEATURE FLAGS
# ==========================================

# Chunking inteligente para documentos grandes (recomendado: true)
ENABLE_CHUNKING=true

# Estratégia híbrida de modelos - reduz custos 60-80% (recomendado: true)
ENABLE_HYBRID_MODELS=true

# Gestão proativa de rate limit - previne erros 429 (recomendado: true)
ENABLE_RATE_LIMITING=true

# Cache de respostas LLM (recomendado: false inicialmente)
ENABLE_CACHING=false

# Processamento paralelo na Etapa 2 - 30% mais rápido (recomendado: false inicialmente)
ENABLE_PARALLEL_ETAPA2=false

# Modo fail-closed: bloqueia pipeline quando validações críticas falham (recomendado: true)
ENABLE_FAIL_CLOSED=true

# Dead-letter queue para falhas não-transientes com snapshot completo (recomendado: true)
ENABLE_DEAD_LETTER_QUEUE=true

# Política de escalonamento por confiança (recomendado: true)
ENABLE_CONFIDENCE_ESCALATION=true
# Escalonar revisão humana quando confiança global ficar abaixo deste limiar
CONFIDENCE_THRESHOLD_GLOBAL=0.75
# Escalonar quando campo crítico (Etapa 1) ficar abaixo deste limiar
CONFIDENCE_THRESHOLD_FIELD=0.75
# Escalonar quando tema (Etapa 2) ficar abaixo deste limiar
CONFIDENCE_THRESHOLD_THEME=0.70
# Consenso N=2 para campos críticos da Etapa 1 em cenários de baixa confiança (opt-in)
ENABLE_ETAPA1_CRITICAL_FIELDS_CONSENSUS=false

# Invariantes de classificação (recomendado em produção)
REQUIRE_EXACTLY_ONE_RECURSO=true
MIN_ACORDAO_COUNT=1
# Modo de revisão manual para classificações ambíguas
ENABLE_CLASSIFICATION_MANUAL_REVIEW=true
# Escalonar para revisão manual quando confiança final da classificação ficar abaixo do limiar
CLASSIFICATION_MANUAL_REVIEW_CONFIDENCE_THRESHOLD=0.65
# Escalonar para revisão manual quando margem entre classes ficar abaixo do limiar
CLASSIFICATION_MANUAL_REVIEW_MARGIN_THRESHOLD=0.15

# ==========================================
# GERENCIAMENTO DE TOKENS
# ==========================================

# OCR automático para PDFs escaneados (recomendado: false até instalar Tesseract/pytesseract)
ENABLE_OCR_FALLBACK=false

# Idiomas do OCR (Tesseract), ex.: por, por+eng
OCR_LANGUAGES=por+eng

# Aciona OCR se média de caracteres por página ficar abaixo deste valor
OCR_TRIGGER_MIN_CHARS_PER_PAGE=20

# Pré-processamento avançado de imagem para OCR (deskew/denoise/binarização)
ENABLE_OCR_PREPROCESSING=true
OCR_DESKEW_ENABLED=true
OCR_DENOISE_ENABLED=true
OCR_BINARIZATION_ENABLED=true
# Limiar de binarização (0-255)
OCR_BINARIZATION_THRESHOLD=160
# Tamanho do kernel de denoise por mediana (ímpar, mínimo 3)
OCR_DENOISE_MEDIAN_SIZE=3

# Gate de qualidade da extração (fail-closed)
# Se ativo, bloqueia pipeline quando qualidade extraída for insuficiente
ENABLE_EXTRACTION_QUALITY_GATE=true
# Qualidade mínima aceitável por documento (0-1)
EXTRACTION_MIN_QUALITY_SCORE=0.2
# Ruído máximo aceitável por documento (0-1)
EXTRACTION_MAX_NOISE_RATIO=0.95

# Ratio do contexto a usar como budget (0.7 = 70% para margem de segurança)
TOKEN_BUDGET_RATIO=0.7

# Overlap de tokens entre chunks (para continuidade de contexto)
CHUNK_OVERLAP_TOKENS=500

# Máximo de tokens por requisição (respeita TPM de 30k/min do GPT-4.1)
MAX_CONTEXT_TOKENS=25000
# Gate de cobertura útil do chunking (fail-closed quando abaixo do mínimo)
ENABLE_CONTEXT_COVERAGE_GATE=true
# Cobertura mínima aceitável (chars/tokens) quando map-reduce é aplicado
CONTEXT_MIN_COVERAGE_RATIO=0.90

# ==========================================
# CACHE E PARALELIZAÇÃO
# ==========================================

# TTL do cache em horas (respostas expiram após este tempo)
CACHE_TTL_HOURS=24

# Workers paralelos para processamento de temas na Etapa 2
# Manter baixo (2-3) para respeitar rate limits
ETAPA2_PARALLEL_WORKERS=3

# ==========================================
# LOGGING
# ==========================================

# Nível de log (DEBUG | INFO | WARNING | ERROR)
LOG_LEVEL=INFO
# Limite de caracteres por mensagem de log após sanitização
MAX_LOG_MESSAGE_CHARS=1200

# Controle de acesso para download na interface web
ENABLE_WEB_DOWNLOAD_ACCESS_CONTROL=true
# Tempo de vida (segundos) do token de download
WEB_DOWNLOAD_TOKEN_TTL_SECONDS=900

# Política de retenção automática de artefatos
ENABLE_RETENTION_POLICY=true
RETENTION_OUTPUT_DAYS=30
RETENTION_CHECKPOINT_DAYS=7
RETENTION_WEB_UPLOAD_DAYS=2
RETENTION_DEAD_LETTER_DAYS=30

# ==========================================
# PROVIDERS ALTERNATIVOS (OPCIONAIS)
# ==========================================

# OpenRouter API (se LLM_PROVIDER=openrouter)
# OPENROUTER_API_KEY=sk-or-...
# OPENROUTER_BASE_URL=https://openrouter.ai/api/v1

# Google AI Studio (se LLM_PROVIDER=google)
# GOOGLE_API_KEY=...
